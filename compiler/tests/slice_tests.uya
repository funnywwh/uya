// Uya语言切片功能测试

struct Vec3 {
    x: f32,
    y: f32,
    z: f32
}

// 简单的错误定义
error SliceError;

// 测试切片功能
fn test_slice_operations() i32 {
    // 创建测试数组
    let arr: [i32; 10] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
    let mut result: i32 = 0;
    
    // 基本切片 [2:5] -> [2, 3, 4]
    let slice1: [i32; 3] = slice(arr, 2, 5);
    for (iter(&slice1)) |val| {
        result = result + val;
    }
    
    // 负数索引切片 [-3:10] -> [7, 8, 9]
    let slice2: [i32; 3] = slice(arr, -3, 10);
    for (iter(&slice2)) |val| {
        result = result + val;
    }
    
    // 从开始到某位置 [0:3] -> [0, 1, 2]
    let slice3: [i32; 3] = slice(arr, 0, 3);
    for (iter(&slice3)) |val| {
        result = result + val;
    }
    
    // 从某位置到末尾 [7:10] -> [7, 8, 9]
    let slice4: [i32; 3] = slice(arr, 7, 10);
    for (iter(&slice4)) |val| {
        result = result + val;
    }
    
    // 负数到负数 [-5:-2] -> [5, 6, 7]
    let slice5: [i32; 3] = slice(arr, -5, -2);
    for (iter(&slice5)) |val| {
        result = result + val;
    }
    
    // 单元素切片
    let slice6: [i32; 1] = slice(arr, 5, 6);
    result = result + slice6[0];
    
    // 空切片
    let slice7: [i32; 0] = slice(arr, 3, 3);
    result = result + len(slice7);  // 应该是0
    
    return result;
}

// 测试字符串切片（使用字节数组）
fn test_string_slice() i32 {
    let str_arr: [byte; 12] = "Hello World!";
    
    // 基本字符串切片 [0:5] -> "Hello"
    let substr1: [byte; 5] = slice(str_arr, 0, 5);
    let mut count: i32 = 0;
    for (iter(&substr1)) |ch| {
        count = count + 1;
    }
    
    // 负数索引字符串切片 [-6:12] -> "World!"
    let substr2: [byte; 6] = slice(str_arr, -6, 12);
    for (iter(&substr2)) |ch| {
        count = count + 1;
    }
    
    return count;
}

// 测试结构体数组切片
fn test_struct_slice() i32 {
    let points: [Vec3; 4] = [
        Vec3{ x: 1.0, y: 2.0, z: 3.0 },
        Vec3{ x: 4.0, y: 5.0, z: 6.0 },
        Vec3{ x: 7.0, y: 8.0, z: 9.0 },
        Vec3{ x: 10.0, y: 11.0, z: 12.0 }
    ];
    
    // 切片结构体数组 [1:3] -> [points[1], points[2]]
    let slice: [Vec3; 2] = slice(points, 1, 3);
    let mut sum: f32 = 0.0;
    for (iter(&slice)) |pt| {
        sum = sum + pt.x + pt.y + pt.z;
    }
    
    return sum as i32;
}

// 综合切片测试
fn slice_comprehensive_test() i32 {
    let mut total: i32 = 0;
    total = total + test_slice_operations();
    total = total + test_string_slice();
    total = total + test_struct_slice();
    return total;
}

fn main() i32 {
    let result: i32 = slice_comprehensive_test();
    return result;
}